<!DOCTYPE html>
<html>
<head>
  <title>Chiptopia Leaderboard</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
  <script src="//cdn.jsdelivr.net/emojione/2.2.5/lib/js/emojione.min.js"></script>
  <link rel="stylesheet" href="//cdn.jsdelivr.net/emojione/2.2.5/assets/css/emojione.min.css"/>
  <script src="stupidtable.min.js"></script>
  <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">
  <style>
    body {
      margin: 20px;
    }
    #leaderboard {
      width: 300px;
    }
    th#peppers {
      min-width: 100px;
    }
    img.pepper {
      width:22px;
    }
    @media only screen and (max-width: 1080px) {
      body {
        font-size: 3em;
        margin: 20px 10px 20px 10px;
      }
      h3 {
        font-size: 1.5em;
        text-align: center;
      }
      #leaderboard {
        width: 100%;
        margin: 0px;
      }
    }
  </style>
  <script>
    $.get('./users').then(function(users){
      var promises = []
      users.forEach(function(user) {
        var promise = $.get('/chip-status/' + encodeURI(user)).then(function(score){
          var level = false;
          var pepperText = '';

          if(score.count >= 11) {
            level = 'hot';
          } else if(score.count >= 8) {
            level = 'medium';
          } else if(score.count >= 4) {
            level = 'mild';
          }

          if(level) {
            pepperText = '<img class="pepper" src="/images/pepper-' + level + '.png" />';
          }
          $("#leaderboard tbody").append("<tr><td>" + emojione.shortnameToImage(user) + "</td><td>" + score.count + "</td><td>" + pepperText + "</td></tr>");
          $("table#leaderboard").stupidtable();
          $("th#score").stupidsort('desc');
        });
      });
    });

  </script>
</head>
<body>
<h3>Chiptopia!!!11â„¢ Leaderboard</h3>
<table id="leaderboard" class="table">
  <thead><tr><th data-sort="string">Name</th><th id="score" data-sort="int" data-sort-default="desc">Score</th><th id="peppers"></th></tr></thead>
  <tbody>
  </tbody>
</table>
</body>
</html>
